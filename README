------ PREPARATION ---------

install httpie
 
>> vi /etc/resolv.conf
search localdomain
nameserver 127.0.0.1
nameserver --the original--
>>

>>
INSTALL dnsmasq
/etc/dnsmasq.d/10-consul.conf
server=/consul/127.0.0.1#8600
<<

docker run -d --name consul -p 8400:8400 -p 8500:8500 -p 8600:53/udp -h node1 progrium/consul -server -bootstrap -ui-dir /ui

CONSUL=<HOST_IP>:8500

echo "Dies ist ein Test | "http PUT $CONSUL/v1/kv/config/webapp/TEST

------ END PREPARATION ---------

------ LIVE DEMO ---------

docker run -d -p 8080:80 --rm --name helloworld svenmalvik/helloworld

curl -X PUT -d '{ "ID": "helloworld","Name": "helloworld","Address": "127.0.0.1","Port": 8080}' http://127.0.0.1:8500/v1/agent/service/register

http :8500/v1/catalog/services

http :8500/v1/catalog/service/helloworld

dig @localhost -p 8600 helloworld.service.consul

docker run -it -P --name helloworld2 --entrypoint bash --env CONSUL=$CONSUL svenmalvik/helloworld 

/opt/envconsul -consul $CONSUL -sanitize -upcase -prefix config/webapp /go/bin/helloworld

docker run -d --name httpd -p 80:80 httpd

docker run -it -p 81:80 --name httpddyn --entrypoint bash --env CONSUL=$CONSUL svenmalvik/httpd

curl -X PUT -d '{ "ID": "helloworlddyn","Name": "helloworlddyn","Address": "127.0.0.1","Port": <PORT>}' http://127.0.0.1:8500/v1/agent/service/register

------ END OF LIVE DEMO ---------
