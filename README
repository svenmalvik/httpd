------ PREPARATION ---------
 sudo yum install -y bind-utils
 sudo yum -y groups install "GNOME Desktop"
 startx

>> vi /etc/resolv.conf
search localdomain
nameserver 127.0.0.1
nameserver --the original--
>>

>>
INSTALL dnsmasq
/etc/dnsmasq.d/10-consul.conf
server=/consul/127.0.0.1#8600
<<

docker run -d --name consul -p 8400:8400 -p 8500:8500 -p 8600:53/udp -h node1 progrium/consul -server -bootstrap -ui-dir /ui

CONSUL=<HOST_IP>:8500

curl -X PUT $CONSUL/v1/kv/config/webapp/TEST -d "Dies ist ein Test"

------ END PREPARATION ---------

------ LIVE DEMO ---------
### Service Discovery ###
docker run -d -p 8080:80 --name helloworld svenmalvik/helloworld
curl -X PUT -d '{ "ID": "helloworld","Name": "helloworld","Address": "<IP>","Port": 8080}' http://127.0.0.1:8500/v1/agent/service/register
curl localhost:8500/v1/catalog/services
curl localhost:8500/v1/catalog/service/helloworld
dig @localhost -p 8600 helloworld.service.consul
dig helloworld.service.consul
curl -X DELETE localhost:8500/v1/agent/service/deregister/helloworld
docker stop helloworld; docker rm helloworld

### envconsul ###
docker run -it -p 8080:80 --name helloworld --entrypoint bash --env CONSUL=$CONSUL svenmalvik/helloworld 
/opt/envconsul -consul $CONSUL -sanitize -upcase -prefix config/webapp /go/bin/helloworld

### consul template ###
docker run -it -p 80:80 --name httpd --entrypoint bash --env CONSUL=$CONSUL svenmalvik/httpd
httpd -k start
consul-template -consul=$CONSUL -template "/etc/consul-templates/app.conf.tmpl:/usr/local/apache2/conf/extra/app.conf:httpd -k restart"
curl -X PUT -d '{ "ID": "helloworld","Name": "helloworld","Address": "<IP>","Port": 8080}' http://127.0.0.1:8500/v1/agent/service/register

------ END OF LIVE DEMO ---------
